================================================================================
问答智能体消耗统计 - 示例输出
================================================================================

场景：3轮问答，每轮生成1个问题和答案，并更新图谱

================================================================================
工作流启动，开始问答循环...

--- 第1轮：调用问智能体 ---
  ✅ 工具调用结果：获取到实体「杂技艺术」，Label：运动项目
  [统计] 问智能体Cypher查询 - 1次
  [统计] 问智能体LLM调用 - 输入:125 token, 输出:48 token
  问智能体生成：问题=杂技艺术包含哪些表演形式？

--- 第1轮：调用答智能体 ---
  [统计] 答智能体搜索调用 - 1次API
  [统计] 答智能体LLM调用 - 输入:356 token, 输出:182 token
  [统计] Cypher执行 - 成功执行4条语句
  答智能体输出结果：成功

--- 第2轮：调用问智能体 ---
  ✅ 工具调用结果：获取到实体「冰壶」，Label：运动项目
  [统计] 问智能体Cypher查询 - 1次
  [统计] 问智能体LLM调用 - 输入:138 token, 输出:52 token
  问智能体生成：问题=冰壶运动的比赛规则是什么？

--- 第2轮：调用答智能体 ---
  [统计] 答智能体搜索调用 - 1次API
  [统计] 答智能体LLM调用 - 输入:378 token, 输出:205 token
  [统计] Cypher执行 - 成功执行5条语句
  答智能体输出结果：成功

--- 第3轮：调用问智能体 ---
  ✅ 工具调用结果：获取到实体「冬季两项」，Label：运动项目
  [统计] 问智能体Cypher查询 - 1次
  [统计] 问智能体LLM调用 - 输入:142 token, 输出:55 token
  问智能体生成：问题=冬季两项包含哪些小项？

--- 第3轮：调用答智能体 ---
  [统计] 答智能体搜索调用 - 1次API
  [统计] 答智能体LLM调用 - 输入:392 token, 输出:218 token
  [统计] Cypher执行 - 成功执行6条语句
  答智能体输出结果：成功

工作流已结束（触发3次ask信号，达到最大次数正常终止）

================================================================================

==================================================================================================================================
问答智能体各活动消耗统计表（运行时长: 18.45秒）
==================================================================================================================================
|   序号 | 活动                                           | 消耗描述                                              | 频次         | Token消耗/成本          |
==================================================================================================================================
|   1    | 启动/触发图谱问答补全                          | 无额外资源消耗（仅系统初始化开销）                     | 1次（工作流启动时触发） | 0                      |
----------------------------------------------------------------------------------------------------------------------------------
|   2    | 问智能体调用Cypher查询工具                     | Neo4j数据库查询资源，无模型token消耗                   | 3次          | 0                      |
----------------------------------------------------------------------------------------------------------------------------------
|   3    | 问智能体调用LLM模型生成问题                    | 消耗Deepseek模型token（输入提示词+输出结果）           | 3次          | 输入:405 / 输出:155 / 总计:560 |
----------------------------------------------------------------------------------------------------------------------------------
|   4    | 答智能体调用搜索工具                          | 消耗SerpAPI搜索次数，无模型token消耗                   | 3次          | 3次API调用             |
----------------------------------------------------------------------------------------------------------------------------------
|   5    | 答智能体调用LLM汇总搜索结果并生成Cypher        | 消耗Deepseek模型token（输入提示词+搜索结果+输出）     | 3次          | 输入:1126 / 输出:605 / 总计:1731 |
----------------------------------------------------------------------------------------------------------------------------------
|   6    | 人机评价机制（未开发）                         | 待定                                                  | 待定         | 0                      |
----------------------------------------------------------------------------------------------------------------------------------
|   7    | 答智能体执行Cypher工具补充知识图谱             | Neo4j数据库写入资源，无模型token消耗                   | 15次         | 0                      |
----------------------------------------------------------------------------------------------------------------------------------
==================================================================================================================================

汇总统计:
  - 总Token消耗: 2291
  - LLM调用总次数: 6
  - 外部API调用总次数: 3
  - 数据库查询次数: 3
  - 数据库写入次数: 15
  - 工作流运行时长: 18.45秒

================================================================================

成本估算（基于Deepseek V3定价）:
  - 输入Token: 1531 × 0.5元/百万 = 0.0007655元
  - 输出Token: 760 × 2.0元/百万 = 0.001520元
  - 总成本: 0.0022855元（约0.23分）

================================================================================

典型场景成本对比:

场景1: 轻量级问答（3轮）
  - Token消耗: ~2000-3000
  - 成本: ~0.002-0.003元（约0.2-0.3分）

场景2: 标准问答（6轮，默认配置）
  - Token消耗: ~4000-6000
  - 成本: ~0.004-0.006元（约0.4-0.6分）

场景3: 深度问答（10轮）
  - Token消耗: ~7000-10000
  - 成本: ~0.007-0.010元（约0.7-1.0分）

场景4: 持续运行（每天100轮）
  - Token消耗: ~40000-60000
  - 成本: ~0.04-0.06元/天（约4-6分/天）
  - 月成本: ~1.2-1.8元/月

================================================================================

性能指标:

单轮问答平均耗时:
  - 问智能体: 1-2秒（数据库查询 + LLM生成）
  - 答智能体: 4-6秒（搜索 + LLM生成 + Cypher执行）
  - 总计: 5-8秒/轮

Token消耗分布:
  - 问智能体: 约25%（平均150-200 token/次）
  - 答智能体: 约75%（平均550-700 token/次）

API调用:
  - SerpAPI搜索: 1次/轮
  - Neo4j查询: 1次/轮
  - Neo4j写入: 3-7次/轮（取决于生成的Cypher语句数）

================================================================================

优化建议:

1. Token优化:
   - 精简提示词模板（可减少10-20% token）
   - 缓存重复搜索结果（可减少重复API调用）
   - 使用更小的上下文窗口

2. 成本优化:
   - 调整max_ask_count控制问答轮数
   - 对简单问题跳过搜索步骤
   - 批量执行Cypher语句减少数据库往返

3. 性能优化:
   - 并发执行独立操作（已实现异步化）
   - 使用连接池复用数据库连接（已实现）
   - 优化Neo4j索引提升查询速度

================================================================================

注意事项:

1. Token消耗受以下因素影响:
   - 提示词长度
   - 搜索结果长度
   - 生成的Cypher复杂度
   - 模型参数配置（temperature等）

2. 实际成本可能因以下情况波动:
   - 不同LLM模型定价不同
   - API调用失败重试
   - 网络延迟导致的超时重试

3. 本统计不包括:
   - 网络传输成本
   - Neo4j数据库存储成本
   - 服务器运行成本
   - 人工审核成本（如果有）

================================================================================

数据来源: 实际运行记录（示例）
日期: 2024-11
统计版本: v1.0

================================================================================

